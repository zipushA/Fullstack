<div class="user-form-container">
    <div class="header-actions">
      <h1 class="page-title">{{ isEditMode ? 'Edit User' : 'Create User' }}</h1>
    </div>
   @if(loading) 
   { <div class="loading-container">
      <mat-spinner></mat-spinner>
    </div>}
    @if(!loading)
   { <mat-card >
      <mat-card-content>
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()">
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName" placeholder="First Name" required>
              @if(userForm.get('firstName')?.errors?.['required']){<mat-error>First name is required</mat-error>}
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName" placeholder="Last Name" required>
             @if(userForm.get('lastName')?.errors?.['required']){ <mat-error >Last name is required</mat-error>}
            </mat-form-field>
          </div>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" placeholder="Email" type="email" required>
              <mat-icon matSuffix>email</mat-icon>
             @if(userForm.get('email')?.errors?.['required']){ <mat-error>Email is required</mat-error>}
            @if(userForm.get('email')?.errors?.['email']) { <mat-error>Please enter a valid email address</mat-error>}
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Password {{ isEditMode ? '(Leave blank to keep current)' : '' }}</mat-label>
              <input matInput formControlName="password" type="password" [required]="!isEditMode">
             @if(userForm.get('password')?.errors?.['required']){ <mat-error>Password is required</mat-error>}
             @if(userForm.get('password')?.errors?.['minlength']) {<mat-error>Password must be at least 6 characters</mat-error>}
            </mat-form-field>
          </div>
          
          <div class="form-row">
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Phone Number</mat-label>
              <input matInput formControlName="phoneNumber" placeholder="Phone Number" required>
              <mat-icon matSuffix>phone</mat-icon>
             @if(userForm.get('phoneNumber')?.errors?.['required']) {<mat-error>Phone number is required</mat-error>}
             @if(userForm.get('phoneNumber')?.errors?.['pattern']) {<mat-error>Please enter a valid 10-digit phone number</mat-error>}
            </mat-form-field>
            
            <mat-form-field appearance="outline" class="form-field">
              <mat-label>Role</mat-label>
              <mat-select formControlName="role" required>
                <!-- <mat-option *ngFor="let role of roles" [value]="role">
                  {{ role | titlecase }}
                </mat-option> -->
                @for (role of roles; track role) {
                    <mat-option [value]="role">
                      {{ role | titlecase }}
                    </mat-option>
                  }
              </mat-select>
             @if(userForm.get('role')?.errors?.['required']) {<mat-error >Role is required</mat-error>}
            </mat-form-field>
          </div>
          
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Residential Area</mat-label>
            <input matInput formControlName="residentialArea" placeholder="Residential Area" required>
            <mat-icon matSuffix>location_on</mat-icon>
           @if(userForm.get('residentialArea')?.errors?.['required']) {<mat-error>Residential area is required</mat-error>}
          </mat-form-field>
          
          <div class="form-actions">
            <button mat-button type="button" [routerLink]="isEditMode ? ['/users', userId] : ['/users']">Cancel</button>
            <button mat-raised-button color="primary" type="submit" [disabled]="userForm.invalid">
              {{ isEditMode ? 'Update' : 'Create' }}
            </button>
          </div>
        </form>
      </mat-card-content>
    </mat-card>}
  </div>
  